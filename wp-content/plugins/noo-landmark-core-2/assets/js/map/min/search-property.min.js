!function(a){"use strict";a(".noo-advanced-search-property-form").length>0&&(a(".noo-advanced-search-property-form").each(function(b,c){function w(){var b=document.getElementById(e),c={flat:!1,noClear:!1,zoom:f,scrollwheel:!1,draggable:!Modernizr.touch&&j,disableDefaultUI:!0,center:new google.maps.LatLng(o),mapTypeId:google.maps.MapTypeId.ROADMAP,streetViewControl:!0,mapTypeControl:!1,panControl:!1,rotateControl:!1,zoomControl:!1};r=new google.maps.Map(b,c),google.maps.visualRefresh=!0,google.maps.event.addListener(r,"tilesloaded",function(){d.find(".gmap-loading").hide()}),x(),y();var g={content:document.createElement("div"),disableAutoPan:!0,maxWidth:500,boxClass:"noo-property-item-map-wrap",zIndex:null,closeBoxMargin:"0",infoBoxClearance:new google.maps.Size(1,1),isHidden:!1,pane:"floatPane",enableEventPropagation:!1};s=new InfoBox(g),p=a.parseJSON(Noo_Map_Property.markers),z(),E();var h=[{textColor:"#ffffff",opt_textColor:"#ffffff",url:Noo_Map_Property.markerClusterer,height:72,width:72,textSize:15}];u=new MarkerClusterer(r,t,{gridSize:50,ignoreHidden:!0,styles:h,maxZoom:13}),u.setIgnoreHidden(!0)}function x(){if("undefined"==typeof l||""===l){if(a("#address_map").length>0)return!1;var b=document.getElementById("address_map");if(""==b||null==b)return!1;var c={types:[n]},d=new google.maps.places.Autocomplete(b,c);"all"===m?d.setComponentRestrictions([]):d.setComponentRestrictions({country:m}),d.bindTo("bounds",r),d.addListener("place_changed",function(){s.close();var a=d.getPlace();if(!a.geometry)return void window.alert("Autocomplete's returned place contains no geometry");for(var e,b=new google.maps.LatLngBounds,c=0;e=a[c];c++){new google.maps.Marker({map:r,zoom:f,title:e.name,position:e.geometry.location});b.extend(e.geometry.location)}r.fitBounds(b),r.setZoom(13)})}}function y(){var a=document.getElementById("gmap_search_input"),b=new google.maps.places.SearchBox(a);google.maps.event.addListener(b,"places_changed",function(){var a=b.getPlaces();if(0!=a.length){for(var e,c=new google.maps.LatLngBounds,d=0;e=a[d];d++){new google.maps.Marker({map:r,zoom:13,title:e.name,position:e.geometry.location});c.extend(e.geometry.location)}r.fitBounds(c),r.setZoom(13)}})}function z(){if("property"===i){if(p.length>0)for(var b=new google.maps.LatLngBounds,c=0;c<p.length;c++){var d=p[c],e=new google.maps.LatLng(d.latitude,d.longitude),f=D(),g={position:e,map:r,icon:{path:MAP_PIN,fillColor:Noo_Map_Property.background_map,fillOpacity:1,strokeColor:"",strokeWeight:0},map_icon_label:'<span class="noo-icon-map fa '+d.icon_markers+'" style="color: '+Noo_Map_Property.background_map+'"></span>'};a.extend(g,d);var h=new Marker(g);t.push(h),F(h,f)&&b.extend(h.getPosition()),google.maps.event.addListener(h,"click",function(a){A(this)})}}else if("idx"===i){var f=D(),b=new google.maps.LatLngBounds;if("object"!=typeof dsidx||a.isEmptyObject(dsidx.dataSets))for(var c=0;c<Noo_Source_IDX.length;c++){var d=Noo_Source_IDX[c],e=new google.maps.LatLng(d.latitude,d.longitude),g={position:e,map:r,icon:{path:MAP_PIN,fillColor:Noo_Map_Property.background_map,fillOpacity:1,strokeColor:"",strokeWeight:0},map_icon_label:'<span class="noo-icon-map fa '+d.icon_markers+'" style="color: '+Noo_Map_Property.background_map+'"></span>'};a.extend(g,d);var h=new Marker(g);t.push(h),F(h,f)&&b.extend(h.getPosition()),google.maps.event.addListener(h,"click",function(a){A(this)})}else{var j=null;a.each(dsidx.dataSets,function(a,b){j=a});for(var c=0;c<dsidx.dataSets[j].length;c++){var d=dsidx.dataSets[j][c],e=new google.maps.LatLng(d.Latitude,d.Longitude);d.latitude=d.Latitude,d.longitude=d.Longitude,d._bathrooms=parseInt(d.BedsShortString.charAt(0)),d._bedrooms=parseInt(d.BathsShortString.charAt(0)),d.url=Noo_Map_Property.url_idx+d.PrettyUriForUrl,d.image=d.PhotoUriBase+"0-medium.jpg",d.price=parseFloat(d.Price.replace(/[^\d.]/g,"")),d.price_html=d.Price,d._area=d.ImprovedSqFt+" "+Noo_Property.area_unit,d.icon_markers="fa-home";var l=d.ShortDescription.split(",");d.city=l[1],d.title=l[0]+", "+l[1];var g={position:e,map:r,icon:{path:MAP_PIN,fillColor:Noo_Map_Property.background_map,fillOpacity:1,strokeColor:"",strokeWeight:0},map_icon_label:'<span class="noo-icon-map fa '+d.icon_markers+'" style="color: '+Noo_Map_Property.background_map+'"></span>'};a.extend(g,d);var h=new Marker(g);t.push(h),F(h,f)&&b.extend(h.getPosition()),google.maps.event.addListener(h,"click",function(a){A(this)})}}}k&&r.fitBounds(b)}function A(a){s.close(),s.setContent(C(a)),s.open(r,a),r.setCenter(a.getPosition()),r.panBy(50,-120)}function C(a){var b="";"undefined"!=typeof a._area&&(b='<span class="noo-area"><i class="icon-ruler"></i>'+a._area+"</span>");var c="";"undefined"!=typeof a._bedrooms&&(c='<span class="noo-bed"><i class="icon-bed"></i>'+a._bedrooms+"</span>");var d="";"undefined"!=typeof a._bathrooms&&(d='<span class="noo-bath"><i class="icon-bath"></i>'+a._bathrooms+"</span>");var e="";return"undefined"!=typeof a._garages&&(e='<span class="noo-storage"><i class="icon-storage"></i>'+a._garages+"</span>"),'<div class="noo-property-item-map"><div class="noo-thumbnail"><a target="_blank" href="'+a.url+'" title="'+a.title+'"><img src="'+a.image+'" alt="'+a.title+'" /></a></div><div class="noo-content"><h4 class="noo-content-title"><a target="_blank" href="'+a.url+'" title="'+a.title+'">'+a.title+'</a></h4><div class="noo-info">'+b+c+d+e+'</div><div class="noo-action"><div class="noo-price">'+a.price_html+'</div><a class="more" target="_blank" href="'+a.url+'" title="'+a.title+'"><i class="fa fa-plus" aria-hidden="true"></i></a></div></div></div><!-- /.noo-property-item-map -->'}function D(){return a(".noo-form-halfmap").length>0?a(".noo-form-halfmap").serializeArray():d.serializeArray()}function E(){a(".noo-form-halfmap").length>0?a(".noo-form-halfmap").find(".noo-item-wrap").find(":input").on("change",function(){if("undefined"!=typeof s&&null!==s&&s.close(),t.length>0){q=new google.maps.LatLngBounds,"undefined"!=typeof u&&u.setIgnoreHidden(!0);for(var b=D(),c=0,d=0;d<t.length;d++){var e=t[d];F(e,b)&&(q.extend(e.getPosition()),c++)}"undefined"!=typeof u&&u.repaint(),q.isEmpty()||r.fitBounds(q),r.setZoom(13);var f=a(".noo-form-halfmap"),g=f.serializeArray();g.push({name:"action",value:"loadmore_property_request"},{name:"security",value:Noo_Map_Property.security},{name:"style",value:"style-2"}),a.ajax({url:Noo_Map_Property.ajax_url,type:"POST",dataType:"html",data:g,beforeSend:function(){a(".noo-advanced-search-property").find(".noo-list-property").html('<div class="noo-loading-property"><i class="ion-ios-loop fa fa-spin"></i></div>'),a(".noo-advanced-search-property").find(".noo-map-footer").hide()},success:function(b){a(".noo-advanced-search-property").find(".noo-list-property").find(".noo-loading-property").remove(),a(".noo-advanced-search-property").find(".noo-list-property").html(b).hide(),a(".noo-advanced-search-property").find(".noo-list-property").slideToggle(1e3),a(".noo-advanced-search-property").find(".noo-map-footer").slideToggle(1333)}})}}):d.find(".noo-item-wrap").find(":input").on("change",function(){if("undefined"!=typeof s&&null!==s&&s.close(),t.length>0){q=new google.maps.LatLngBounds,"undefined"!=typeof u&&u.setIgnoreHidden(!0);for(var a=D(),b=0,c=0;c<t.length;c++){var e=t[c];F(e,a)&&(q.extend(e.getPosition()),b++)}"undefined"!=typeof u&&u.repaint(),d.find(".show-filter-property").show().find("b").html(b),q.isEmpty()||r.fitBounds(q)}})}function F(b,c){if(null==b||"undefined"==typeof b)return!1;if(null==c||"undefined"==typeof c)return!1;var d=!1;return a.each(c,function(e,f){if(null==c[e].name||"undefined"==typeof c[e].name)return!1;if(null==c[e].value||"undefined"==typeof c[e].value)return!1;var g=c[e].name,h=c[e].value;if("idx"===i){if("address_map"===g&&null==b.title.match(new RegExp(h,"g")))return b.setVisible(!1),d=!0,!1;if("MinPrice"===g&&parseInt(b.price)<parseInt(h))return b.setVisible(!1),d=!0,!1;if("MaxPrice"===g&&parseInt(b.price)>parseInt(h))return b.setVisible(!1),d=!0,!1;if("idx-q-BathsMin"===g&&parseInt(b.noo_property_bathrooms)<parseInt(h))return b.setVisible(!1),d=!0,!1;if("idx-q-BedsMin"===g&&parseInt(b.noo_property_bedrooms)<parseInt(h))return b.setVisible(!1),d=!0,!1}else if("property"===i&&""!==h&&null!==h&&"undefined"!=typeof b[g]){if("min_price"===g&&parseInt(b.price)<parseInt(h))return b.setVisible(!1),d=!0,!1;if("max_price"===g&&parseInt(b.price)>parseInt(h))return b.setVisible(!1),d=!0,!1;if("min_area"===g&&parseInt(b.area)<parseInt(h))return b.setVisible(!1),d=!0,!1;if("max_area"===g&&parseInt(b.area)>parseInt(h))return b.setVisible(!1),d=!0,!1;if(a.isArray(b[g])){if("status"===g&&b.status.toString()!==h)return b.setVisible(!1),d=!0,!1;if("types"===g&&b.types.toString()!==h)return b.setVisible(!1),d=!0,!1;if("location"===g&&b.location.toString()!==h)return b.setVisible(!1),d=!0,!1;if("city"===g&&b.city.toString()!==h)return b.setVisible(!1),d=!0,!1;if("neighborhood"===g&&b.neighborhood.toString()!==h)return b.setVisible(!1),d=!0,!1;if("zip"===g&&b.zip.toString()!==h)return b.setVisible(!1),d=!0,!1}else if(h!==b[g])return b.setVisible(!1),d=!0,!1}}),d?(b.setVisible(!1),!1):(b.setVisible(!0),!0)}function G(a){var b=new google.maps.LatLng(a[0],a[1]);r.setCenter(b),r.setZoom(13);var c={position:b,map:r,icon:{path:MAP_PIN,fillColor:Noo_Map_Property.background_map,fillOpacity:1,strokeColor:"",strokeWeight:0},map_icon_label:'<span class="noo-icon-map fa fa-street-view" style="color: '+Noo_Map_Property.background_map+'"></span>'},d=new Marker(c);t.push(d);var e={strokeColor:Noo_Map_Property.background_map,strokeOpacity:.6,strokeWeight:1,fillColor:Noo_Map_Property.background_map,fillOpacity:.2,map:r,center:b,radius:parseInt(5e3,10)};new google.maps.Circle(e)}function H(a){if(s.close(),navigator.geolocation){var b;"https:"===o.protocol?navigator.geolocation.getCurrentPosition(showMyPosition_original,errorCallback,{timeout:1e4}):jQuery.getJSON("http://ipinfo.io",function(a){b=a.loc.split(","),G(b)})}else alert("can not find your location")}var p,q,r,s,u,d=a(this),e=d.find(".noo-search-map").data("id"),f=parseInt(d.find(".noo-search-map").data("zoom")),g=parseFloat(d.find(".noo-search-map").data("latitude")),h=parseFloat(d.find(".noo-search-map").data("longitude")),i=d.find(".noo-search-map").data("source"),j=d.find(".noo-search-map").data("drag-map"),k=d.find(".noo-search-map").data("fitbounds"),l=d.find(".noo-search-map").data("disable_auto_complete"),m=d.find(".noo-search-map").data("country_restriction"),n=d.find(".noo-search-map").data("location_type"),o={lat:g,lng:h},t=[],v=0,I=function(b){if(a("body").find('input[name="'+b+'"]').length>0){var c=jQuery.parseJSON(Noo_Property.data_autocomplete);if("idx"==i)var c=Noo_Source_IDX_autocomplete;var d=a('input[name="'+b+'"]').autocomplete({source:c,delay:300,minLength:1,change:function(){},select:function(){E()}});d.autocomplete("option","change").call(d),a('input[name="'+b+'"]').trigger("keydown")}};I("address_map"),I("keyword"),document.getElementById(d.find(".gmap-zoom > .zoom-in").attr("id"))&&google.maps.event.addDomListener(document.getElementById(d.find(".gmap-zoom > .zoom-in").attr("id")),"click",function(){s.close();var a=parseInt(r.getZoom(),10);a++,a>20&&(a=15),r.setZoom(a)}),document.getElementById(d.find(".gmap-zoom > .miniature").attr("id"))&&google.maps.event.addDomListener(document.getElementById(d.find(".gmap-zoom > .miniature").attr("id")),"click",function(){s.close();var a=parseInt(r.getZoom(),10);a--,a<0&&(a=0),r.setZoom(a)}),a(d.find(".map-view-type")).on("click","> span",function(b){b.preventDefault(),s.close();var c=a(this),d=c.data("type");"roadmap"===d?r.setMapTypeId(google.maps.MapTypeId.ROADMAP):"satellite"===d?r.setMapTypeId(google.maps.MapTypeId.SATELLITE):"hybrid"===d?r.setMapTypeId(google.maps.MapTypeId.HYBRID):"terrain"===d&&r.setMapTypeId(google.maps.MapTypeId.TERRAIN)}),d.find(".my-location")&&google.maps.event.addDomListener(document.getElementById(d.find(".my-location").attr("id")),"click",function(){s.close(),H(r)}),a(d.find(".gmap-full")).click(function(){s.close(),d.find(".noo-search-map").hasClass("fullmap")?(a("body").removeClass("body-fullmap"),d.removeClass("fullmap"),d.find(".noo-search-map").removeClass("fullmap"),a(this).empty().html('<i class="fa fa-expand"></i> '+Noo_Map_Property.label_fullscreen),Modernizr.touch&&r.setOptions({draggable:!1})):(a("body").addClass("body-fullmap"),d.addClass("fullmap"),d.find(".noo-search-map").addClass("fullmap"),a(this).empty().html('<i class="fa fa-compress"></i> '+Noo_Map_Property.label_default),Modernizr.touch&&r.setOptions({draggable:!0})),google.maps.event.trigger(r,"resize")}),a(d.find(".gmap-prev")).click(function(){for(s.close(),v--,v<1&&(v=t.length);t[v-1].visible===!1;)v--,v>t.length&&(v=1);r.getZoom()<15&&r.setZoom(15),google.maps.event.trigger(t[v-1],"click")}),a(d.find(".gmap-next")).click(function(){for(s.close(),v++,v>t.length&&(v=1);t[v-1].visible===!1;)v++,v>t.length&&(v=1);r.getZoom()<15&&r.setZoom(15),google.maps.event.trigger(t[v-1],"click")}),a(".noo-sw-section").length>0&&"undefined"!==a.cookie&&(null!=a.cookie("noo-selector-color")&&(Noo_Map_Property.background_map=a.cookie("noo-selector-color")),a(document).bind("noo-color-changed",function(){var b=null!=a.cookie("noo-selector-color")?a.cookie("noo-selector-color"):"#114a82";if(null!=a.cookie("noo-selector-color"))for(var c=0;c<t.length;c++)t[c].setIcon({path:MAP_PIN,fillColor:b,fillOpacity:1,strokeColor:"",strokeWeight:0})})),google.maps.event.addDomListener(window,"load",w)}),a(".noo-box-map").length>0&&a(".noo-box-map").each(function(b,c){var d=a(this),e=d.closest(".noo-advanced-search-property"),f=e.find(".noo-advanced-search-property-form").serializeArray();f.push({name:"action",value:"loadmore_property_request"},{name:"security",value:Noo_Map_Property.security}),d.find(".noo-action-search-top").on("click",".show-filter-property",function(b){b.preventDefault();var d=(a(this),a(this).closest(".noo-advanced-search-property")),e=d.find(".noo-advanced-search-property-form").serializeArray();e.push({name:"action",value:"loadmore_property_request"},{name:"security",value:Noo_Map_Property.security}),a.ajax({url:Noo_Map_Property.ajax_url,type:"POST",dataType:"html",data:e,beforeSend:function(){d.find(".noo-results-property").show().html('<div class="noo-loading-property"><i class="ion-ios-loop fa fa-spin"></i></div>')},success:function(a){d.find(".noo-results-property").find(".noo-loading-property").remove(),d.find(".noo-results-property").html(a).hide(),d.find(".noo-results-property").slideToggle(1e3)}})}),e.on("click",".loadmore-results",function(b){b.preventDefault();var c=a(this),d=parseInt(c.data("current-page"));f.push({name:"current_page",value:d+1}),a.ajax({url:Noo_Map_Property.ajax_url,type:"POST",dataType:"html",data:f,beforeSend:function(){a('<div class="noo-loading-property"><i class="ion-ios-loop fa fa-spin"></i></div>').appendTo(e.find(".noo-results-property")),e.find(".noo-results-property").find(".loadmore-results-wrap").remove()},success:function(b){e.find(".noo-results-property").find(".noo-loading-property").remove(),a(b).appendTo(e.find(".noo-results-property"))}})})}),a(".noo-box-map").length>0&&a(".noo-box-map").on("change",'select[name="orderby"]',function(b){b.preventDefault();var c=a(".noo-box-map").find(".sort-property").serializeArray();c.push({name:"action",value:"loadmore_property_request"},{name:"security",value:Noo_Map_Property.security},{name:"style",value:"style-2"},{name:"show_loadmore_ajax",value:!1}),a.ajax({url:Noo_Map_Property.ajax_url,type:"POST",dataType:"html",data:c,beforeSend:function(){a(".noo-advanced-search-property").find(".noo-list-property").html('<div class="noo-loading-property"><i class="ion-ios-loop fa fa-spin"></i></div>'),a(".noo-advanced-search-property").find(".noo-map-footer").hide()},success:function(b){a(".noo-advanced-search-property").find(".noo-list-property").find(".noo-loading-property").remove(),a(".noo-advanced-search-property").find(".noo-list-property").html(b).hide(),a(".noo-advanced-search-property").find(".noo-list-property").slideToggle(1e3),a(".noo-advanced-search-property").find(".noo-map-footer").slideToggle(1333)}})}))}(jQuery);