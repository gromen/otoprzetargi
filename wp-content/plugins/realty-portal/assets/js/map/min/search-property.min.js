!function(e){"use strict";e(".rp-advanced-search-property-form").length>0&&(e(".rp-advanced-search-property-form").each(function(){function o(){var o=document.getElementById(v),r={flat:!1,noClear:!1,zoom:_,scrollwheel:!1,draggable:!Modernizr.touch&&w,disableDefaultUI:!0,center:new google.maps.LatLng(k),mapTypeId:google.maps.MapTypeId.ROADMAP,streetViewControl:!0,mapTypeControl:!1,panControl:!1,rotateControl:!1,zoomControl:!1};f=new google.maps.Map(o,r),google.maps.visualRefresh=!0,google.maps.event.addListener(f,"tilesloaded",function(){h.find(".gmap-loading").hide()}),t(),n();var i={content:document.createElement("div"),disableAutoPan:!0,maxWidth:500,boxClass:"rp-property-item-map-wrap",zIndex:null,closeBoxMargin:"0",infoBoxClearance:new google.maps.Size(1,1),isHidden:!1,pane:"floatPane",enableEventPropagation:!1};g=new InfoBox(i),m=e.parseJSON(RP_Map_Property.markers),a(),p()}function t(){if(void 0===M||""===M){if(e("#address_map").length>0)return!1;var o=document.getElementById("address_map");if(""==o||null==o)return!1;var t={types:[S]},n=new google.maps.places.Autocomplete(o,t);"all"===P?n.setComponentRestrictions([]):n.setComponentRestrictions({country:P}),n.bindTo("bounds",f),n.addListener("place_changed",function(){g.close();var e=n.getPlace();if(!e.geometry)return void window.alert("Autocomplete's returned place contains no geometry");for(var o,t=new google.maps.LatLngBounds,a=0;o=e[a];a++)new google.maps.Marker({map:f,zoom:_,title:o.name,position:o.geometry.location}),t.extend(o.geometry.location);f.fitBounds(t),f.setZoom(13)})}}function n(){var e=document.getElementById("gmap_search_input"),o=new google.maps.places.SearchBox(e);google.maps.event.addListener(o,"places_changed",function(){var e=o.getPlaces();if(0!=e.length){for(var t,n=new google.maps.LatLngBounds,a=0;t=e[a];a++)new google.maps.Marker({map:f,zoom:13,title:t.name,position:t.geometry.location}),n.extend(t.geometry.location);f.fitBounds(n),f.setZoom(13)}})}function a(){if("property"===x){if(m.length>0)for(var o=new google.maps.LatLngBounds,t=0;t<m.length;t++){var n=m[t],a=new google.maps.LatLng(n.latitude,n.longitude),i=s(),p={position:a,map:f};e.extend(p,n);var d=new Marker(p);B.push(d),l(d,i)&&o.extend(d.getPosition()),google.maps.event.addListener(d,"click",function(){r(this)})}}else if("idx"===x){var i=s(),o=new google.maps.LatLngBounds;if("object"!=typeof dsidx||e.isEmptyObject(dsidx.dataSets))for(var t=0;t<RP_Source_IDX.length;t++){var n=RP_Source_IDX[t],a=new google.maps.LatLng(n.latitude,n.longitude),p={position:a,map:f};e.extend(p,n);var d=new Marker(p);B.push(d),l(d,i)&&o.extend(d.getPosition()),google.maps.event.addListener(d,"click",function(){r(this)})}else{var c=null;e.each(dsidx.dataSets,function(e){c=e});for(var t=0;t<dsidx.dataSets[c].length;t++){var n=dsidx.dataSets[c][t],a=new google.maps.LatLng(n.Latitude,n.Longitude);n.latitude=n.Latitude,n.longitude=n.Longitude,n._bathrooms=parseInt(n.BedsShortString.charAt(0)),n._bedrooms=parseInt(n.BathsShortString.charAt(0)),n.url=RP_Map_Property.url_idx+n.PrettyUriForUrl,n.image=n.PhotoUriBase+"0-medium.jpg",n.price=parseFloat(n.Price.replace(/[^\d.]/g,"")),n.price_html=n.Price,n._area=n.ImprovedSqFt+" "+RP_Property.area_unit,n.icon_markers="rp-icon-home";var u=n.ShortDescription.split(",");n.city=u[1],n.title=u[0]+", "+u[1];var p={position:a,map:f};e.extend(p,n);var d=new Marker(p);B.push(d),l(d,i)&&o.extend(d.getPosition()),google.maps.event.addListener(d,"click",function(){r(this)})}}}L&&o&&f.fitBounds(o)}function r(e){g.close(),g.setContent(i(e)),g.open(f,e),f.setCenter(e.getPosition()),f.panBy(50,-120)}function i(e){var o="";"undefined"!=typeof e._area&&(o='<span class="rp-area"><i class="rp-icon-ruler"></i>'+e._area+"</span>");var t="";"undefined"!=typeof e._bedrooms&&(t='<span class="rp-bed"><i class="rp-icon-bed"></i>'+e._bedrooms+"</span>");var n="";"undefined"!=typeof e._bathrooms&&(n='<span class="rp-bath"><i class="rp-icon-bath"></i>'+e._bathrooms+"</span>");var a="";return"undefined"!=typeof e._garages&&(a='<span class="rp-storage"><i class="rp-icon-garage"></i>'+e._garages+"</span>"),'<div class="rp-property-item-map"><div class="rp-thumbnail"><a target="_blank" href="'+e.url+'" title="'+e.title+'"><img src="'+e.image+'" alt="'+e.title+'" /></a></div><div class="rp-content"><h4 class="rp-content-title"><a target="_blank" href="'+e.url+'" title="'+e.title+'">'+e.title+'</a></h4><div class="rp-info">'+o+t+n+a+'</div><div class="rp-action"><div class="rp-price">'+e.price_html+'</div><a class="more" target="_blank" href="'+e.url+'" title="'+e.title+'"><i class="rp-icon-plus" aria-hidden="true"></i></a></div></div></div><!-- /.rp-property-item-map -->'}function s(){return e(".page-template-property-half-map .rp-form-halfmap").length>0?e(".page-template-property-half-map .rp-form-halfmap").serializeArray():h.serializeArray()}function p(){e(".page-template-property-half-map .rp-form-halfmap").length>0?e(".page-template-property-half-map .rp-form-halfmap").find(".rp-item-wrap").find(":input").on("change",function(){if(void 0!==g&&null!==g&&g.close(),B.length>0){u=new google.maps.LatLngBounds,void 0!==y&&y.setIgnoreHidden(!0);for(var o=s(),t=0,n=0;n<B.length;n++){var a=B[n];l(a,o)&&(u.extend(a.getPosition()),t++)}void 0!==y&&y.repaint(),u.isEmpty()||f.fitBounds(u);var r=e(".page-template-property-half-map .rp-form-halfmap"),i=r.serializeArray();i.push({name:"action",value:"loadmore_property_request"},{name:"security",value:RP_Map_Property.security},{name:"style",value:"style-2"}),e.ajax({url:RP_Map_Property.ajax_url,type:"POST",dataType:"html",data:i,beforeSend:function(){e(".rp-advanced-search-property").find(".rp-list-property").html('<div class="rp-loading-property"><i class="rp-icon-ion-ios-loop rp-icon-spin"></i></div>'),e(".rp-advanced-search-property").find(".rp-map-footer").hide()},success:function(o){e(".rp-advanced-search-property").find(".rp-list-property").find(".rp-loading-property").remove(),e(".rp-advanced-search-property").find(".rp-list-property").html(o).hide(),e(".rp-advanced-search-property").find(".rp-list-property").slideToggle(1e3),e(".rp-advanced-search-property").find(".rp-map-footer").slideToggle(1333)}})}}):h.find(".rp-item-wrap").find(":input").on("change",function(){if(void 0!==g&&null!==g&&g.close(),B.length>0){u=new google.maps.LatLngBounds,void 0!==y&&y.setIgnoreHidden(!0);for(var e=s(),o=0,t=0;t<B.length;t++){var n=B[t];l(n,e)&&(u.extend(n.getPosition()),o++)}void 0!==y&&y.repaint(),h.find(".show-filter-property").show().find("b").html(o),u.isEmpty()||(f.fitBounds(u),o<B.length-1&&f.setZoom(14))}})}function l(o,t){if(null==o||void 0===o)return!1;if(null==t||void 0===t)return!1;var n=!1;return e.each(t,function(a){if(null==t[a].name||"undefined"==typeof t[a].name)return!1;if(null==t[a].value||"undefined"==typeof t[a].value)return!1;var r=t[a].name,i=t[a].value;if("idx"===x){if("address_map"===r&&null==o.title.match(new RegExp(i,"g")))return o.setVisible(!1),n=!0,!1;if("MinPrice"===r&&parseInt(o.price)<parseInt(i))return o.setVisible(!1),n=!0,!1;if("MaxPrice"===r&&parseInt(o.price)>parseInt(i))return o.setVisible(!1),n=!0,!1;if("idx-q-BathsMin"===r&&parseInt(o.rp_property_bathrooms)<parseInt(i))return o.setVisible(!1),n=!0,!1;if("idx-q-BedsMin"===r&&parseInt(o.rp_property_bedrooms)<parseInt(i))return o.setVisible(!1),n=!0,!1}else if("property"===x&&""!==i&&null!==i&&"undefined"!=typeof o[r]){if("min_price"===r&&parseInt(o.price)<parseInt(i))return o.setVisible(!1),n=!0,!1;if("max_price"===r&&parseInt(o.price)>parseInt(i))return o.setVisible(!1),n=!0,!1;if("min_area"===r&&parseInt(o.area)<parseInt(i))return o.setVisible(!1),n=!0,!1;if("max_area"===r&&parseInt(o.area)>parseInt(i))return o.setVisible(!1),n=!0,!1;if(e.isArray(o[r])){if("status"===r&&o.status.toString()!==i)return o.setVisible(!1),n=!0,!1;if("types"===r&&o.types.toString()!==i)return o.setVisible(!1),n=!0,!1;if("location"===r&&o.location.toString()!==i)return o.setVisible(!1),n=!0,!1;if("city"===r&&o.city.toString()!==i)return o.setVisible(!1),n=!0,!1;if("neighborhood"===r&&o.neighborhood.toString()!==i)return o.setVisible(!1),n=!0,!1;if("zip"===r&&o.zip.toString()!==i)return o.setVisible(!1),n=!0,!1}else if(i!==o[r])return o.setVisible(!1),n=!0,!1}}),n?(o.setVisible(!1),!1):(o.setVisible(!0),!0)}function d(e){var o=new google.maps.LatLng(e[0],e[1]);f.setCenter(o),f.setZoom(13);var t={position:o,map:f},n=new Marker(t);B.push(n);var a={strokeColor:"#ffdf94",strokeOpacity:.6,strokeWeight:1,fillColor:"#ffdf94",fillOpacity:.2,map:f,center:o,radius:parseInt(5e3,10)};new google.maps.Circle(a)}function c(){if(g.close(),navigator.geolocation){var e;"https:"===k.protocol?navigator.geolocation.getCurrentPosition(showMyPosition_original,errorCallback,{timeout:1e4}):jQuery.getJSON("http://ipinfo.io",function(o){e=o.loc.split(","),d(e)})}else alert("can not find your location")}var m,u,f,g,y,h=e(this),v=h.find(".rp-search-map").data("id"),_=parseInt(h.find(".rp-search-map").data("zoom")),b=parseFloat(h.find(".rp-search-map").data("latitude")),I=parseFloat(h.find(".rp-search-map").data("longitude")),x=h.find(".rp-search-map").data("source"),w=h.find(".rp-search-map").data("drag-map"),L=h.find(".rp-search-map").data("fitbounds"),M=h.find(".rp-search-map").data("disable_auto_complete"),P=h.find(".rp-search-map").data("country_restriction"),S=h.find(".rp-search-map").data("location_type"),k={lat:b,lng:I},B=[],T=0;if(void 0===v)return!1;var z=function(o){if(e("body").find('input[name="'+o+'"]').length>0){var t=jQuery.parseJSON(RP_Property.data_autocomplete);if("idx"==x)var t=RP_Source_IDX_autocomplete;var n=e('input[name="'+o+'"]').autocomplete({source:t,delay:300,minLength:1,change:function(){},select:function(){p()}});n.autocomplete("option","change").call(n),e('input[name="'+o+'"]').trigger("keydown")}};z("address_map"),z("keyword"),document.getElementById(h.find(".gmap-zoom > .zoom-in").attr("id"))&&google.maps.event.addDomListener(document.getElementById(h.find(".gmap-zoom > .zoom-in").attr("id")),"click",function(){g.close();var e=parseInt(f.getZoom(),10);e++,e>20&&(e=15),f.setZoom(e)}),document.getElementById(h.find(".gmap-zoom > .miniature").attr("id"))&&google.maps.event.addDomListener(document.getElementById(h.find(".gmap-zoom > .miniature").attr("id")),"click",function(){g.close();var e=parseInt(f.getZoom(),10);e--,e<0&&(e=0),f.setZoom(e)}),e(h.find(".map-view-type")).on("click","> span",function(o){o.preventDefault(),g.close();var t=e(this),n=t.data("type");"roadmap"===n?f.setMapTypeId(google.maps.MapTypeId.ROADMAP):"satellite"===n?f.setMapTypeId(google.maps.MapTypeId.SATELLITE):"hybrid"===n?f.setMapTypeId(google.maps.MapTypeId.HYBRID):"terrain"===n&&f.setMapTypeId(google.maps.MapTypeId.TERRAIN)}),h.find(".my-location")&&google.maps.event.addDomListener(document.getElementById(h.find(".my-location").attr("id")),"click",function(){g.close(),c(f)}),e(h.find(".gmap-full")).click(function(){g.close(),h.find(".rp-search-map").hasClass("fullmap")?(e("body").removeClass("body-fullmap"),h.removeClass("fullmap"),h.find(".rp-search-map").removeClass("fullmap"),e(this).empty().html('<i class="rp-icon-expand"></i> '+RP_Map_Property.label_fullscreen),Modernizr.touch&&f.setOptions({draggable:!1})):(e("body").addClass("body-fullmap"),h.addClass("fullmap"),h.find(".rp-search-map").addClass("fullmap"),e(this).empty().html('<i class="rp-icon-compress"></i> '+RP_Map_Property.label_default),Modernizr.touch&&f.setOptions({draggable:!0})),google.maps.event.trigger(f,"resize")}),e(h.find(".gmap-prev")).click(function(){for(g.close(),--T<1&&(T=B.length);B[T-1].visible===!1;)--T>B.length&&(T=1);f.getZoom()<15&&f.setZoom(15),google.maps.event.trigger(B[T-1],"click")}),e(h.find(".gmap-next")).click(function(){for(g.close(),++T>B.length&&(T=1);B[T-1].visible===!1;)++T>B.length&&(T=1);f.getZoom()<15&&f.setZoom(15),google.maps.event.trigger(B[T-1],"click")}),google.maps.event.addDomListener(window,"load",o)}),e(".rp-box-map").length>0&&e(".rp-box-map").each(function(){var o=e(this),t=o.closest(".rp-advanced-search-property"),n=t.find(".rp-advanced-search-property-form").serializeArray();n.push({name:"action",value:"loadmore_property_request"},{name:"security",value:RP_Map_Property.security}),o.find(".rp-action-search-top").on("click",".show-filter-property",function(o){o.preventDefault();var t=e(this).closest(".rp-advanced-search-property"),n=t.find(".rp-advanced-search-property-form").serializeArray();n.push({name:"action",value:"loadmore_property_request"},{name:"security",value:RP_Map_Property.security}),e.ajax({url:RP_Map_Property.ajax_url,type:"POST",dataType:"html",data:n,beforeSend:function(){t.find(".rp-results-property").show().html('<div class="rp-loading-property"><i class="rp-icon-ion-ios-loop rp-icon-spin"></i></div>'),e(".rp-property-main").remove()},success:function(e){t.find(".rp-results-property").find(".rp-loading-property").remove(),t.find(".rp-results-property").html(e).hide(),t.find(".rp-results-property").slideToggle(1e3)}})}),t.on("click",".loadmore-results",function(o){o.preventDefault();var a=e(this),r=parseInt(a.data("current-page"));n.push({name:"current_page",value:r+1}),e.ajax({url:RP_Map_Property.ajax_url,type:"POST",dataType:"html",data:n,beforeSend:function(){e('<div class="rp-loading-property"><i class="rp-icon-ion-ios-loop rp-icon-spin"></i></div>').appendTo(t.find(".rp-results-property")),t.find(".rp-results-property").find(".loadmore-results-wrap").remove()},success:function(o){t.find(".rp-results-property").find(".rp-loading-property").remove(),e(o).appendTo(t.find(".rp-results-property"))}})})}),e(".rp-box-map").length>0&&e(".rp-box-map").on("change",'select[name="orderby"]',function(o){o.preventDefault();var t=e(".rp-box-map").find(".sort-property").serializeArray();t.push({name:"action",value:"loadmore_property_request"},{name:"security",value:RP_Map_Property.security},{name:"style",value:"style-2"},{name:"show_loadmore_ajax",value:!1}),e.ajax({url:RP_Map_Property.ajax_url,type:"POST",dataType:"html",data:t,beforeSend:function(){e(".rp-advanced-search-property").find(".rp-list-property").html('<div class="rp-loading-property"><i class="rp-icon-ion-ios-loop rp-icon-spin"></i></div>'),e(".rp-advanced-search-property").find(".rp-map-footer").hide()},success:function(o){e(".rp-advanced-search-property").find(".rp-list-property").find(".rp-loading-property").remove(),e(".rp-advanced-search-property").find(".rp-list-property").html(o).hide(),e(".rp-advanced-search-property").find(".rp-list-property").slideToggle(1e3),e(".rp-advanced-search-property").find(".rp-map-footer").slideToggle(1333)}})}))}(jQuery);